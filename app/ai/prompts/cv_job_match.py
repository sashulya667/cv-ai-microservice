def system_prompt(version: str) -> str:
    if version == "v1":
        return (
            "Ты — эксперт по подбору персонала и ATS-матчингу CV под вакансию. "
            "Твоя цель — честно оценить соответствие и дать практичные рекомендации, как повысить шанс прохождения ATS и интервью. "
            "Не выдумывай факты о кандидате и не приписывай навыки, которых нет в CV. "
            "Если требование вакансии не покрыто CV — так и напиши. "
            "Возвращай ТОЛЬКО валидный JSON строго по схеме, без markdown и без лишних ключей. "
            "ВЕСЬ ТЕКСТ В JSON ДОЛЖЕН БЫТЬ СТРОГО НА РУССКОМ ЯЗЫКЕ."
        )
    return system_prompt("v1")


def user_prompt(*, job_description: str) -> str:
    return f"""
У тебя есть CV (вложение) и описание вакансии (ниже). Оцени соответствие и дай план улучшений.

ОПИСАНИЕ ВАКАНСИИ:
{job_description}

Верни JSON ТОЧНО по схеме:
{{
  "match_score": int,
  "ats_match_score": int,
  "seniority_fit": "underqualified" | "aligned" | "overqualified",
  "overall_fit": "poor" | "moderate" | "good" | "strong",
  "summary": str,
  "matching_strengths": [str, ...],
  "gaps": [str, ...],
  "recommendations": [str, ...],
  "matching_keywords": [str, ...],
  "missing_keywords": [str, ...],
  "section_feedback": {{
    "<cv_section>": "<feedback>"
  }}
}}

Правила:
- Вывод ТОЛЬКО валидный JSON (без markdown, без текста вне JSON, без лишних ключей).
- Все строки в JSON — строго на русском языке.
- match_score и ats_match_score: 0..100.
- Не выдумывай факты. Любой вывод должен быть основан на тексте CV и вакансии. Если информации нет — прямо укажи, что "не видно в CV".
- summary: 5–8 предложений. Дай вердикт, уровень соответствия, 3 главных сильных стороны и 3 главных пробела, и что делать в первую очередь.
- matching_strengths: 5–8 пунктов. Формат: "Требование вакансии → чем подтверждено в CV".
- gaps: 6–10 пунктов. Разделяй смыслом: must-have пробелы (критично) и nice-to-have (желательно) — но без новых ключей, просто в тексте пункта помечай "[MUST]" или "[NICE]".
- recommendations: 8–12 пунктов, строго практические и в порядке приоритета:
  1) что добавить/переписать в CV (буллеты, секции, формулировки, метрики),
  2) какие проекты/доказательства описать,
  3) как адаптировать навыки/ключевые слова под ATS (без спама).
- matching_keywords: 8–15 ключевых слов/фраз из вакансии, которые реально присутствуют в CV (нормальные слова/технологии/роли, не мусор).
- missing_keywords: 8–15 важных ключевых слов/фраз из вакансии, которые НЕ встречаются в CV (и которые разумно добавить только если кандидат реально это делал/умеет).
- section_feedback: используй реальные названия секций из CV. Для каждой: 2–4 предложения + 2–3 конкретные правки.

Доп. критерии ATS:
- приоритет must-have требований вакансии,
- доказательность (опыт/проекты/метрики) важнее просто списка навыков,
- совпадение названий технологий/инструментов/домена,
- ясность: короткие буллеты, глаголы действия, цифры.
""".strip()