def system_prompt(version: str) -> str:
    if version == "v1":
        return (
            "Ты — эксперт по подбору персонала и ATS-матчингу CV под вакансию. "
            "Твоя цель — честно оценить соответствие и дать практичные рекомендации, как повысить шанс прохождения ATS и интервью. "
            "Не выдумывай факты о кандидате и не приписывай навыки, которых нет в CV. "
            "Если требование вакансии не покрыто CV — так и напиши. "
            "Возвращай ТОЛЬКО валидный JSON строго по схеме, без markdown и без лишних ключей. "
            "ВЕСЬ ТЕКСТ В JSON ДОЛЖЕН БЫТЬ СТРОГО НА РУССКОМ ЯЗЫКЕ."
        )
    return system_prompt("v1")


def user_prompt(*, job_description: str) -> str:
    return f"""
У тебя есть CV (вложение) и описание вакансии (ниже). Оцени соответствие и дай план улучшений.

ОПИСАНИЕ ВАКАНСИИ:
{job_description}

Верни JSON ТОЧНО по схеме:
{{
  "match_score": int,
  "ats_match_score": int,
  "seniority_fit": "underqualified" | "aligned" | "overqualified",
  "overall_fit": "poor" | "moderate" | "good" | "strong",
  "summary": str,
  "matching_strengths": [str, ...],
  "gaps": [str, ...],
  "recommendations": [str, ...],
  "matching_keywords": [str, ...],
  "missing_keywords": [str, ...],
  "section_feedback": {{
    "<cv_section>": "<feedback>"
  }}
}}

Правила:
- Вывод ТОЛЬКО валидный JSON (без markdown, без текста вне JSON, без лишних ключей).
- Все строки в JSON — строго на русском языке.
- match_score и ats_match_score: 0..100.
- Не выдумывай факты. Любой вывод должен быть основан на тексте CV и вакансии. Если информации нет — прямо укажи, что "не видно в CV".

- summary: 5–8 предложений. 
  Структура: 
  1) Общий вердикт (подходит/не подходит и почему)
  2) Seniority fit (underqualified/aligned/overqualified с обоснованием)
  3) Топ-3 сильных совпадения с вакансией
  4) Топ-3 критичных пробела
  5) Главная рекомендация (что делать в первую очередь)

- matching_strengths: 5–8 пунктов. 
  Формат: "Требование из вакансии → конкретное подтверждение из CV (где именно, какой проект/опыт)"
  Пример: "Python 5+ years → подтверждено: 3 года в Bereke Bank + 2 года фриланс (проекты X, Y)"

- gaps: 6–10 пунктов. 
  Разделяй по критичности:
  - Начинай с "[MUST-HAVE]" для критичных требований вакансии, которых нет в CV
  - Потом "[NICE-TO-HAVE]" для желательных, но не обязательных
  - Для каждого пробела укажи: что отсутствует и как это может повлиять на решение рекрутера

- recommendations: 8–12 пунктов, строго практические и в порядке приоритета:
  1) ЧТО конкретно добавить в CV (какие буллеты, в какой раздел, с какими формулировками)
  2) ЧТО переписать для лучшего матча с вакансией (примеры формулировок)
  3) Какие проекты/достижения детализировать и как
  4) Какие ключевые слова органично добавить (БЕЗ keyword stuffing)
  5) Как адаптировать структуру CV под требования вакансии

- matching_keywords: 8–15 ключевых слов/фраз из вакансии, которые РЕАЛЬНО присутствуют в CV.
  Выбирай значимые термины (технологии, инструменты, методологии, домены).
  НЕ включай общие слова типа "опыт", "разработка", "работа".

- missing_keywords: 8–15 важных ключевых слов/фраз из вакансии, которые НЕ встречаются в CV.
  Включай только те, которые кандидат РЕАЛЬНО мог бы добавить (если у него есть этот опыт).
  Отмечай критичность: добавь "[!]" к must-have требованиям вакансии.

- section_feedback: используй реальные названия секций из CV. 
  Для каждой секции:
  1) Как текущий контент соотносится с требованиями вакансии (2-3 предложения)
  2) Конкретные правки: что добавить, что переписать, что удалить (3-5 пунктов)
  3) Приоритет правок (что критично, что желательно)

Критерии оценки:
- match_score: насколько CV соответствует требованиям вакансии (опыт, навыки, проекты)
- ats_match_score: насколько CV оптимизировано для прохождения ATS (ключевые слова, структура, форматирование)
- seniority_fit: 
  * underqualified = опыт/навыки ниже требуемого уровня
  * aligned = опыт соответствует требованиям
  * overqualified = опыт существенно превышает требования
- overall_fit:
  * poor = <50% совпадение, много критичных пробелов
  * moderate = 50-70% совпадение, есть важные пробелы
  * good = 70-85% совпадение, в основном nice-to-have пробелы
  * strong = >85% совпадение, минимум пробелов

ВАЖНО: Будь максимально конкретным. Избегай общих фраз. Приводи примеры из CV и вакансии.
""".strip()