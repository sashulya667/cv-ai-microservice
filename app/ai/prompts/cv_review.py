def system_prompt(version: str) -> str:
    if version == "v1":
        return (
            "Ты — опытный рекрутер и ATS-специалист. "
            "Оцениваешь CV по ясности, структуре, релевантности вакансии (если она не дана — оцени по рынку), "
            "доказательности (метрики/результаты) и читабельности для ATS. "
            "Не выдумывай факты: если чего-то нет — так и скажи. "
            "Возвращай ТОЛЬКО валидный JSON, строго по схеме, без markdown и без лишних ключей. "
            "ВЕСЬ ТЕКСТ В JSON ДОЛЖЕН БЫТЬ СТРОГО НА РУССКОМ ЯЗЫКЕ."
        )
    return system_prompt("v1")


def user_prompt(compare: bool = False) -> str:
    base =  """
Верни JSON ТОЧНО по схеме:
{
  "overall_score": int,
  "ats_score": int,
  "summary": str,
  "strengths": [str, ...],
  "weaknesses": [str, ...],
  "improvements": [str, ...],
  "section_feedback": {
    "<section_title_from_cv>": "<feedback>",
    "<another_section_title>": "<feedback>"
  }
}

Правила:
- Вывод ТОЛЬКО валидный JSON (без markdown, без пояснений вне JSON, без лишних ключей).
- Все строки в JSON — строго на русском языке.
- overall_score и ats_score: 0..100.
- Не выдумывай факты. Любой вывод должен опираться на текст CV; если данных нет — прямо укажи "не указано/не видно в CV".
- summary: 4–7 предложений. Дай общий вердикт и 2–3 главных рычага улучшения.
- strengths: 5–8 пунктов, конкретные (что уже хорошо и почему).
- weaknesses: 5–8 пунктов, конкретные (что мешает и как это проявляется).
- improvements: 8–12 пунктов, максимально практичные, в порядке приоритета (сначала то, что даст максимальный прирост).
- section_feedback: используй реальные заголовки разделов из CV. Для каждого: 2–4 предложения + 2–3 точечных правки (что добавить/переписать).

ATS-проверки (учти в оценке и рекомендациях):
- структура и стандартные секции (Опыт, Навыки, Образование, Проекты, Языки, Сертификаты),
- наличие/качество дат, локаций, должностей,
- читабельность (маркированные списки, длина буллетов),
- ключевые навыки и технологии, их "доказательство" в опыте,
- измеримость (цифры/метрики/результаты),
- качество формулировок (глаголы действия, отсутствие воды),
- возможные красные флаги (пробелы, несостыковки дат) — только если это видно из CV.

Если CV "шумное" (плохой текст/разметка), скажи об этом в summary и дай советы, как улучшить исходный файл (без лишних деталей).
""".strip()
    
    if not compare:
        return base

    compare_block = """
ДОПОЛНИТЕЛЬНО (загружено 2 файла CV):
- Файл 1 = ТЕКУЩАЯ версия CV (её оцениваем и по ней ставим scores).
- Файл 2 = ПРЕДЫДУЩАЯ версия CV (используем только для сравнения).
- overall_score и ats_score относятся ТОЛЬКО к Файлу 1.

Требования к сравнению:
- Добавь в section_feedback специальный ключ:
  section_feedback["Сравнение"] = "<текст на русском>"
- В "Сравнение" обязательно:
  1) Что улучшилось (добавлено/удалено/переписано) и почему это повысило качество/ATS.
  2) Что ухудшилось или стало менее ясным (если есть).
  3) Что осталось критически недоделанным (must-fix).
  4) Оценка изменения (примерно): "Δ overall: +N, Δ ATS: +M" (это оценка, не факт).
- В improvements сначала дай действия, которые логично вытекают из сравнения (что делать дальше после этих правок).
""".strip()

    return base + "\n\n" + compare_block